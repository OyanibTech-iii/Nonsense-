{% extends 'admin/base_admin.html.twig' %}

{% block title %}Admin Dashboard | Growfico{% endblock %}

{% block header_title %}
<h2 class="text-xl font-semibold text-dark-forest-green">Dashboard</h2>
{% set role_display = 'USER' %}
{% if 'ROLE_ADMIN' in user.roles %}
{% set role_display = 'ADMIN' %}
{% elseif 'ROLE_STAFF' in user.roles %}
{% set role_display = 'STAFF' %}
{% endif %}
<p class="text-sm text-light-gray">Welcome back! {{ role_display }} Here's what's happening with your platform.</p>
{% endblock %}

{% block admin_content %}
<div class="max-w-7xl mx-auto">
	<!-- Stats Cards Grid -->
	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
		<!-- Users Card -->
		<div
			class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm font-medium text-light-gray mb-1">Total Users</p>
					<p class="text-3xl font-bold text-dark-forest-green">{{ total_users|number_format }}</p>
					<p class="text-sm text-light-gray">Registered users</p>
				</div>
				<div class="w-12 h-12 bg-primary-50 rounded-xl flex items-center justify-center">
					<ion-icon name="people-outline" class="text-2xl text-bright-green"></ion-icon>
				</div>
			</div>
			<div class="flex items-center mt-4">
				<span
					class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-100 text-bright-green">
					<svg class="w-3 h-3 mr-1" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd"
							d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
							clip-rule="evenodd"></path>
					</svg>
					+12%
				</span>
				<span class="text-xs text-light-gray ml-2">vs last week</span>
			</div>
		</div>

		<!-- Products Card -->
		<div
			class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm font-medium text-light-gray mb-1">Products</p>
					<p class="text-3xl font-bold text-dark-forest-green">{{ total_products|number_format }}</p>
					<p class="text-sm text-light-gray">Active listings</p>
				</div>
				<div class="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center">
					<ion-icon name="pricetags-outline" class="text-2xl text-primary-600"></ion-icon>
				</div>
			</div>
			<div class="flex items-center mt-4">
				<span
					class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-200 text-primary-700">
					<svg class="w-3 h-3 mr-1" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd"
							d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
							clip-rule="evenodd"></path>
					</svg>
					+8%
				</span>
				<span class="text-xs text-light-gray ml-2">vs last month</span>
			</div>
		</div>

		<!-- Revenue Card -->
		<div
			class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm font-medium text-light-gray mb-1">Revenue</p>
					<p class="text-3xl font-bold text-dark-forest-green">₱{{ total_revenue|number_format }}</p>
					<p class="text-sm text-light-gray">This month</p>
				</div>
				<div class="w-12 h-12 bg-forest-50 rounded-xl flex items-center justify-center">
					<ion-icon name="cash-outline" class="text-2xl text-primary-600"></ion-icon>
				</div>
			</div>
			<div class="flex items-center mt-4">
				<span
					class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-forest-100 text-primary-600">
					<svg class="w-3 h-3 mr-1" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd"
							d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
							clip-rule="evenodd"></path>
					</svg>
					+23%
				</span>
				<span class="text-xs text-light-gray ml-2">vs last month</span>
			</div>
		</div>

		<!-- Gardens Card -->
		<div
			class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm font-medium text-light-gray mb-1">Gardens</p>
					<p class="text-3xl font-bold text-dark-forest-green">{{ active_gardens }}</p>
					<p class="text-sm text-light-gray">Active projects</p>
				</div>
				<div class="w-12 h-12 bg-primary-200 rounded-xl flex items-center justify-center">
					<ion-icon name="leaf-outline" class="text-2xl text-primary-600"></ion-icon>
				</div>
			</div>
			<div class="flex items-center mt-4">
				<span
					class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-300 text-primary-800">
					<svg class="w-3 h-3 mr-1" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd"
							d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
							clip-rule="evenodd"></path>
					</svg>
					+5%
				</span>
				<span class="text-xs text-light-gray ml-2">vs last month</span>
			</div>
		</div>
	</div>

	<!-- Chart Section -->
	<div class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm mb-8">
		<div class="flex items-center justify-between mb-6">
			<div>
				<h3 class="text-lg font-semibold text-dark-forest-green">User Growth</h3>
				<p class="text-sm text-light-gray">Track your user acquisition over time</p>
			</div>
			<div class="flex items-center gap-2">
				<div class="inline-flex items-center rounded-lg bg-gray-50 border border-gray-200">
					<button type="button"
						class="timeframe-btn px-3 py-1.5 text-sm font-medium text-dark-forest-green bg-white rounded-l-lg"
						data-range="7">7d</button>
					<button type="button" class="timeframe-btn px-3 py-1.5 text-sm font-medium text-light-gray"
						data-range="30">30d</button>
					<button type="button"
						class="timeframe-btn px-3 py-1.5 text-sm font-medium text-light-gray rounded-r-lg"
						data-range="90">90d</button>
				</div>
				<button id="download-chart-btn" type="button"
					class="px-3 py-1.5 text-sm font-medium text-bright-green hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors duration-200">
					Download Chart
					<ion-icon name="download-outline" class="ml-1 text-sm"></ion-icon>
				</button>
			</div>
		</div>
		<canvas id="area-chart" class="w-full h-80" data-total-users="{{ total_users|default(0) }}"
			data-growth="{{ user_growth|default([])|json_encode|e('html_attr') }}"
			data-dates="{{ user_growth_dates|default([])|json_encode|e('html_attr') }}"></canvas>
	</div>

	{# Chart.js - minimal bundle via CDN and initialization #}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const chartEl = document.getElementById('area-chart');
			const totalUsers = Number(chartEl.dataset.totalUsers) || 0;
			const ctx = chartEl.getContext('2d');

			// Try to read real data arrays passed from the controller via Twig
			let growthData = [];
			let labels = [];
			if (chartEl.dataset.growth) {
				try { growthData = JSON.parse(chartEl.dataset.growth); } catch (e) { growthData = []; }
			}
			if (chartEl.dataset.dates) {
				try { labels = JSON.parse(chartEl.dataset.dates); } catch (e) { labels = []; }
			}

			// If growthData provided, use it directly. Otherwise synthesize a 7-day trend.
			let dataPoints = [];
			if (Array.isArray(growthData) && growthData.length > 0) {
				dataPoints = growthData.map(n => Number(n));
				// If no labels or mismatch, generate date labels for the data length
				if (!Array.isArray(labels) || labels.length !== dataPoints.length) {
					labels = [];
					const n = dataPoints.length;
					for (let i = n - 1; i >= 0; i--) {
						const d = new Date();
						d.setDate(d.getDate() - i);
						labels.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
					}
				}
			} else {
				// Fallback: 7-day synthetic trend that ends at totalUsers
				for (let i = 6; i >= 0; i--) {
					const d = new Date();
					d.setDate(d.getDate() - i);
					labels.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
				}
				for (let i = 0; i < 7; i++) {
					const factor = 0.5 + 0.5 * (i / 6);
					dataPoints.push(Math.round(totalUsers * factor));
				}
			}

			// Enforce a max height to prevent Chart.js from stretching the canvas
			const MAX_CANVAS_PX = 320;
			chartEl.style.height = MAX_CANVAS_PX + 'px';
			chartEl.style.maxHeight = MAX_CANVAS_PX + 'px';
			chartEl.style.width = '100%';

			// Create gradient fill using theme-like greens
			const gradient = ctx.createLinearGradient(0, 0, 0, 200);
			gradient.addColorStop(0, 'rgba(16,185,129,0.16)');
			gradient.addColorStop(1, 'rgba(6,78,59,0.04)');

			const adminChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: labels,
					datasets: [{
						label: 'Users',
						data: dataPoints,
						fill: true,
						backgroundColor: gradient,
						borderColor: '#065f46',
						pointBackgroundColor: '#10B981',
						tension: 0.35,
						pointRadius: 3,
						borderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false }
					},
					scales: {
						x: {
							grid: { display: false },
							ticks: { color: '#6b7280' }
						},
						y: {
							grid: { color: 'rgba(15,23,42,0.04)' },
							ticks: { color: '#6b7280', beginAtZero: true }
						}
					},
					elements: {
						line: { capBezierPoints: true }
					}
				}
			});

			// expose to window for controls
			window.adminChart = adminChart;

			// helper to update chart for a given number of days
			function updateForRange(days) {
				let pts = [];
				let lbls = [];
				if (Array.isArray(growthData) && growthData.length > 0) {
					// use most recent `days` points if available
					const n = Math.min(days, growthData.length);
					pts = growthData.slice(-n).map(Number);
					lbls = labels.slice(-n);
					// if labels empty or mismatch, generate relative labels
					if (!Array.isArray(lbls) || lbls.length !== pts.length) {
						lbls = [];
						for (let i = pts.length - 1; i >= 0; i--) {
							const d = new Date();
							d.setDate(d.getDate() - i);
							lbls.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
						}
					}
				} else {
					// synthesize `days` points ending at totalUsers
					for (let i = days - 1; i >= 0; i--) {
						const d = new Date();
						d.setDate(d.getDate() - i);
						lbls.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
					}
					for (let i = 0; i < days; i++) {
						const factor = 0.2 + 0.8 * (i / Math.max(1, days - 1));
						pts.push(Math.round(totalUsers * factor));
					}
				}

				adminChart.data.labels = lbls;
				adminChart.data.datasets[0].data = pts;
				adminChart.update();
			}

			// wire timeframe buttons
			document.querySelectorAll('.timeframe-btn').forEach(btn => {
				btn.addEventListener('click', function () {
					document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('bg-white', 'text-dark-forest-green'));
					this.classList.add('bg-white', 'text-dark-forest-green');
					const days = Number(this.dataset.range) || 7;
					updateForRange(days);
				});
			});

			// Download chart flow (requires admin password)
			const downloadBtn = document.getElementById('download-chart-btn');
			// CSRF token for authorize endpoint
			const csrfToken = "{{ csrf_token('admin_dashboard_download') }}";

			// Function to generate and download the PDF with retry logic
			function downloadChartAsPDF(base64Img) {
				function attemptDownload(retries = 0) {
					if (typeof html2pdf === 'undefined') {
						if (retries < 15) {
							// Wait 300ms and retry (increased from 200ms and increased max retries)
							setTimeout(() => attemptDownload(retries + 1), 300);
							return;
					} else {
						showErrorModal('Failed to load PDF library', 'Please refresh the page and try again, or try a different browser.');
						return;
					}
					}

					const element = document.createElement('div');
					element.innerHTML = `
						<div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
							<h2 style="color: #065f46; margin-bottom: 20px;">User Growth Chart</h2>
							<img src="${base64Img}" style="max-width: 100%; height: auto;" alt="Chart"/>
							<p style="margin-top: 20px; color: #666; font-size: 12px;">Generated on ${new Date().toLocaleString()}</p>
						</div>
					`;

					const opt = {
						margin: 10,
						filename: 'user-growth-chart.pdf',
						image: { type: 'jpeg', quality: 0.98 },
						html2canvas: { scale: 2 },
						jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
					};

					try {
						html2pdf().set(opt).from(element).save();
					} catch (error) {
						console.error('PDF generation error:', error);
						showErrorModal('PDF Generation Error', 'Error generating PDF: ' + error.message);
					}
				}
				attemptDownload();
			}

			// create modal markup with backdrop blur and eye icon for password toggle
			const modalHtml = `
								<div id="download-modal" class="fixed inset-0 z-50 hidden backdrop-blur-md" style="display: flex; align-items: center; justify-content: center;">
									<div class="absolute inset-0 bg-black/40 backdrop-blur-md"></div>
									<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 relative z-10">
										<div class="flex items-center gap-4 mb-4">
											<div class="w-12 h-12 rounded-full bg-bright-green/10 flex items-center justify-center">
												<ion-icon name="download-outline" class="text-2xl text-bright-green"></ion-icon>
											</div>
											<div>
												<h3 class="text-lg font-semibold text-dark-forest-green">Download Chart as PDF</h3>
												<p class="text-xs text-light-gray">Verify your admin password</p>
											</div>
										</div>
										<p class="text-sm text-light-gray mb-5">Enter your admin password to download the chart as a PDF file.</p>
										<form id="download-form">
											<div class="relative mb-4">
												<input type="password" id="download-password" name="password" placeholder="Admin password" class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm" required />
												<button type="button" id="toggle-password-visibility" class="absolute right-3 top-1/2 -translate-y-1/2 text-light-gray hover:text-dark-forest-green transition-colors">
													<ion-icon name="eye-outline" class="text-xl"></ion-icon>
												</button>
											</div>
											<div class="flex gap-3">
												<button type="button" id="download-cancel" class="flex-1 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200 text-dark-forest-green font-medium transition-colors duration-200">Cancel</button>
												<button type="submit" class="flex-1 px-4 py-2.5 rounded-lg bg-bright-green hover:bg-green-600 text-white font-medium transition-colors duration-200 flex items-center justify-center gap-2">
													<ion-icon name="download-outline" class="text-lg"></ion-icon>Download PDF
												</button>
											</div>
										</form>
									</div>
								</div>`;

			function openModal() {
				const div = document.createElement('div');
				div.innerHTML = modalHtml;
				document.body.appendChild(div);
				document.getElementById('download-password').focus();

				// Eye icon toggle for password visibility
				const toggleBtn = document.getElementById('toggle-password-visibility');
				const pwdInput = document.getElementById('download-password');
				toggleBtn.addEventListener('click', function (e) {
					e.preventDefault();
					const isPassword = pwdInput.type === 'password';
					pwdInput.type = isPassword ? 'text' : 'password';
					toggleBtn.innerHTML = isPassword
						? '<ion-icon name="eye-off-outline" class="text-xl"></ion-icon>'
						: '<ion-icon name="eye-outline" class="text-xl"></ion-icon>';
				});

				// cancel handler
				document.getElementById('download-cancel').addEventListener('click', () => closeModal());
				// form handler
				document.getElementById('download-form').addEventListener('submit', async function (e) {
					e.preventDefault();
					const pwd = document.getElementById('download-password').value;
					try {
						const res = await fetch("{{ path('app_admin_dashboard_authorize') }}", {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								'X-CSRF-TOKEN': csrfToken
							},
							body: JSON.stringify({ password: pwd })
						});

						const json = await res.json();
						
						if (json.authorized) {
							// get chart image as base64
							const img = adminChart.toBase64Image();
							// trigger PDF download using canvas-to-pdf
							downloadChartAsPDF(img);
							closeModal();
						} else {
							const errorMsg = json.message || 'Invalid password. Please try again.';
							showErrorModal('Invalid Password', errorMsg);
						}
					} catch (err) {
						console.error('Authorization error:', err);
						showErrorModal('Authorization Failed', 'Authorization failed: ' + err.message);
					}
				});
			}

			function closeModal() {
				const m = document.getElementById('download-modal');
				if (m) m.parentNode.remove();
			}

			downloadBtn.addEventListener('click', function () {
				openModal();
			});
		});

		// Reusable modal functions
		function showErrorModal(title, message) {
			showModal(title, message, 'error', 'OK', false);
		}

		function showSuccessModal(title, message) {
			showModal(title, message, 'success', 'OK', false);
		}

		function showInfoModal(title, message) {
			showModal(title, message, 'info', 'OK', false);
		}

		function showModal(title, message, type = 'info', confirmText = 'OK', showCancel = false) {
			const modalId = 'dynamic-modal-' + Date.now();
			const iconMap = {
				'error': { name: 'alert-circle-outline', bg: 'bg-red-100', text: 'text-red-600' },
				'warning': { name: 'warning-outline', bg: 'bg-yellow-100', text: 'text-yellow-600' },
				'success': { name: 'checkmark-circle-outline', bg: 'bg-green-100', text: 'text-green-600' },
				'info': { name: 'information-circle-outline', bg: 'bg-blue-100', text: 'text-blue-600' }
			};
			const icon = iconMap[type] || iconMap['info'];
			const buttonColor = type === 'error' ? 'bg-red-600 hover:bg-red-700' : 
								type === 'warning' ? 'bg-yellow-600 hover:bg-yellow-700' :
								type === 'success' ? 'bg-green-600 hover:bg-green-700' :
								'bg-blue-600 hover:bg-blue-700';

			const modalHtml = `
				<div id="${modalId}" class="fixed inset-0 z-50 backdrop-blur-md" style="display: flex;">
					<div class="absolute inset-0 bg-black/40 backdrop-blur-md"></div>
					<div class="absolute inset-0 flex items-center justify-center">
						<div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all relative z-10">
							<div class="flex items-center gap-4 mb-4">
								<div class="w-12 h-12 rounded-full ${icon.bg} flex items-center justify-center">
									<ion-icon name="${icon.name}" class="text-2xl ${icon.text}"></ion-icon>
								</div>
								<div>
									<h3 class="text-lg font-semibold text-dark-forest-green">${title}</h3>
								</div>
							</div>
							<p class="text-sm text-light-gray mb-6">${message}</p>
							<div class="flex gap-3">
								${showCancel ? '<button class="modal-cancel-btn flex-1 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200 text-dark-forest-green font-medium transition-colors duration-200">Cancel</button>' : ''}
								<button class="modal-confirm-btn flex-1 px-4 py-2.5 rounded-lg ${buttonColor} text-white font-medium transition-colors duration-200">${confirmText}</button>
							</div>
						</div>
					</div>
				</div>
			`;

			const div = document.createElement('div');
			div.innerHTML = modalHtml;
			document.body.appendChild(div);
			
			const modal = document.getElementById(modalId);
			const confirmBtn = modal.querySelector('.modal-confirm-btn');
			const cancelBtn = modal.querySelector('.modal-cancel-btn');

			function closeModal() {
				modal.style.display = 'none';
				setTimeout(() => modal.remove(), 300);
			}

			confirmBtn.addEventListener('click', closeModal);
			if (cancelBtn) {
				cancelBtn.addEventListener('click', closeModal);
			}

			modal.addEventListener('click', function(e) {
				if (e.target === modal || e.target.classList.contains('bg-black/40')) {
					closeModal();
				}
			});

			document.addEventListener('keydown', function(e) {
				if (e.key === 'Escape' && modal.style.display !== 'none') {
					closeModal();
				}
			});
		}
	</script>

	<!-- Products Section -->
	<div class="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
		<div class="flex items-center justify-between mb-6">
			<div>
				<h3 class="text-lg font-semibold text-dark-forest-green">Recent Products</h3>
				<p class="text-sm text-light-gray">Latest products in your inventory ({{ total_products }}
					total)</p>
			</div>
			<div class="flex items-center gap-2">
				<a href="{{ path('app_admin_products') }}"
					class="px-3 py-1.5 text-sm font-medium text-light-gray hover:text-dark-forest-green hover:bg-gray-100 rounded-lg transition-colors duration-200">
					View All Products
					<ion-icon name="arrow-forward-outline" class="ml-1 text-sm"></ion-icon>
				</a>
				<a href="{{ path('app_admin_product_new') }}"
					class="px-3 py-1.5 text-sm font-medium text-bright-green hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors duration-200">
					Add Product
					<ion-icon name="add-outline" class="ml-1 text-sm"></ion-icon>
				</a>
			</div>
		</div>

		{% if recent_products is not empty %}
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
			{% for product in recent_products %}
			<div
				class="bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors duration-200 border border-gray-100">
				<div class="flex items-start gap-3">
					<!-- Product Image -->
					<div
						class="w-16 h-16 bg-gradient-to-br from-bright-green/10 to-dark-forest-green/10 rounded-lg flex items-center justify-center flex-shrink-0">
						{% set imagePath = product.getImagePath() %}
						{% if imagePath %}
						<img src="{{ asset(imagePath) }}" alt="{{ product.name }}"
							class="w-full h-full object-cover rounded-lg"
							onerror="this.style.display='none'; this.parentNode.querySelector('.fallback-icon').style.display='flex';">
						<div class="fallback-icon hidden w-full h-full items-center justify-center">
							<ion-icon name="leaf-outline" class="w-6 h-6 text-bright-green"></ion-icon>
						</div>
						{% else %}
						<ion-icon name="leaf-outline" class="w-6 h-6 text-bright-green"></ion-icon>
						{% endif %}
					</div>

					<!-- Product Info -->
					<div class="flex-1 min-w-0">
						<h4 class="text-sm font-semibold text-dark-forest-green truncate">{{ product.name }}</h4>
						<p class="text-xs text-light-gray mb-2 line-clamp-2">{{ product.description }}</p>
						<div class="flex items-center justify-between">
							<span class="text-sm font-bold text-primary-600">₱{{ product.price }}</span>
							{% if product.isAvailable %}
							<span
								class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
								<ion-icon name="checkmark-circle" class="w-3 h-3 mr-1"></ion-icon>
								Available
							</span>
							{% else %}
							<span
								class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
								<ion-icon name="close-circle" class="w-3 h-3 mr-1"></ion-icon>
								Out of Stock
							</span>
							{% endif %}
						</div>
					</div>
				</div>

				{# <!-- Action Buttons -->
				<div class="flex gap-2 mt-3">
					<a href="{{ path('app_admin_product_show', {'id': product.id}) }}"
						class="flex-1 inline-flex items-center justify-center px-3 py-1.5 bg-gray-200 text-dark-forest-green text-xs font-medium rounded-lg hover:bg-gray-300 transition-colors duration-200">
						<ion-icon name="eye-outline" class="w-3 h-3 mr-1"></ion-icon>
						View
					</a>
					<a href="{{ path('app_admin_product_edit', {'id': product.id}) }}"
						class="flex-1 inline-flex items-center justify-center px-3 py-1.5 bg-bright-green text-white text-xs font-medium rounded-lg hover:bg-green-600 transition-colors duration-200">
						<ion-icon name="create-outline" class="w-3 h-3 mr-1"></ion-icon>
						Edit
					</a>
				</div> #}
			</div>
			{% endfor %}
		</div>
		{% else %}
		<!-- Empty State -->
		<div class="text-center py-12">
			<div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
				<ion-icon name="leaf-outline" class="w-8 h-8 text-light-gray"></ion-icon>
			</div>
			<h4 class="text-sm font-semibold text-dark-forest-green mb-2">No products yet</h4>
			<p class="text-xs text-light-gray mb-4 max-w-sm mx-auto">
				Start building your product catalog by adding your first product.
			</p>
			<a href="{{ path('app_admin_product_new') }}"
				class="inline-flex items-center px-4 py-2 bg-bright-green text-white text-sm font-medium rounded-lg hover:bg-green-600 transition-colors duration-200">
				<ion-icon name="add-outline" class="w-4 h-4 mr-2"></ion-icon>
				Add Your First Product
			</a>
		</div>
		{% endif %}
	</div>
</div>
</main>
</div>
</div>

<!-- Custom styles for line-clamp -->
<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	/* Fullscreen-ish chart styling applied inline too for compatibility */
	#area-chart {
		transition: all 200ms ease;
	}
</style>

{% endblock %}